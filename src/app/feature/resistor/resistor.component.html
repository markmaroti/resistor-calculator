@let vm = viewModel();
<h1>Resistor Color Code Calculator</h1>
<app-resistor-preview
  [bandCount]="vm.bandCount"
  [digit1]="store.digit1()"
  [digit2]="store.digit2()"
  [digit3]="store.digit3()"
  [multiplier]="store.multiplier()"
  [tolerance]="store.tolerance()"
  [tcr]="store.tcr()"
/>

<ul class="resistor-controls">
  <li>
    <app-select
      label="Bands"
      [options]="bandCounts"
      [value]="store.bandCount()"
      (valueChange)="onBandCountChange($event)"
    />
  </li>
  <li>
    <app-select
      label="Band 1 (Digit)"
      [options]="digitColors"
      [value]="store.digit1()"
      (valueChange)="store.digit1.set($event)"
    />
  </li>
  <li>
    <app-select
      label="Band 2 (Digit)"
      [options]="digitColors"
      [value]="store.digit2()"
      (valueChange)="store.digit2.set($event)"
    />
  </li>
  @if (vm.showDigit3) {
  <li>
    <app-select
      label="Band 3 (Digit)"
      [options]="digitColors"
      [value]="store.digit3()"
      (valueChange)="store.digit3.set($event)"
    />
  </li>
  }
  <li>
    <app-select
      label="Multiplier"
      [options]="multiplierColors"
      [value]="store.multiplier()"
      (valueChange)="store.multiplier.set($event)"
    />
  </li>

  <li>
    <app-select
      label="Tolerance"
      [options]="toleranceColors"
      [value]="store.tolerance()"
      (valueChange)="store.tolerance.set($event)"
    />
  </li>

  @if (vm.showTcr) {
  <li>
    <app-select
      label="TCR (ppm/°C)"
      [options]="tcrColors"
      [value]="store.tcr()"
      (valueChange)="store.tcr.set($event)"
    />
  </li>
  }
</ul>

<section class="resistor-result" aria-live="polite">
  @if (vm.ohms > 0) {
  <div class="result-label">Resistance</div>
  <div class="result-value">
    <span class="result-ohms">{{ vm.ohms | ohms}}</span>
    @if (vm.tolerancePct !== null) {
    <span class="result-meta">± {{ vm.tolerancePct }}%</span>
    }
    @if (vm.tcrPpm !== null) {
    <span class="result-meta">({{ vm.tcrPpm }} ppm/°C)</span>
    }
  </div>
  } @else {
  <div class="result-empty">Select bands to calculate resistance.</div>
  }
</section>

<section class="resistor-help" aria-live="polite">
  <div class="help-actions">
    <button
      class="help-trigger"
      type="button"
      (click)="toggleHelp()"
      [attr.aria-expanded]="showHelp()"
    >
      {{ showHelp() ? 'Hide how it works' : 'Show how it works' }}
    </button>
    <a class="help-link" routerLink="/guide">Open guide</a>
  </div>
  @defer (when showHelp()) {
  @if (showHelp()) {
  <div class="help-card">
    <h2>How it works</h2>
    <p>
      Each color band encodes a digit, a multiplier, and an optional tolerance/TCR value. Changing
      the bands updates the calculated resistance instantly.
    </p>
    <app-reference-panel />
  </div>
  }
  }
</section>
