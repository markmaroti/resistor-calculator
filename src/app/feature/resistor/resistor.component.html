@let vm = viewModel();
<h1>Resistor Color Code Calculator</h1>
<app-resistor-preview
  [bandCount]="vm.bandCount"
  [digit1]="vm.digit1"
  [digit2]="vm.digit2"
  [digit3]="vm.digit3"
  [multiplier]="vm.multiplier"
  [tolerance]="vm.tolerance"
  [tcr]="vm.tcr"
/>

<ul class="resistor-controls" [formGroup]="form">
  <li>
    <app-select
      label="Bands"
      [options]="bandCounts"
      formControlName="bandCount"
    />
  </li>
  <li>
    <app-select
      label="Band 1 (Digit)"
      [options]="digitColors"
      formControlName="digit1"
    />
  </li>
  <li>
    <app-select
      label="Band 2 (Digit)"
      [options]="digitColors"
      formControlName="digit2"
    />
  </li>
  @if (vm.showDigit3) {
  <li>
    <app-select
      label="Band 3 (Digit)"
      [options]="digitColors"
      formControlName="digit3"
    />
  </li>
  }
  <li>
    <app-select
      label="Multiplier"
      [options]="multiplierColors"
      formControlName="multiplier"
    />
  </li>

  <li>
    <app-select
      label="Tolerance"
      [options]="toleranceColors"
      formControlName="tolerance"
    />
  </li>

  @if (vm.showTcr) {
  <li>
    <app-select
      label="TCR (ppm/°C)"
      [options]="tcrColors"
      formControlName="tcr"
    />
  </li>
  }
</ul>

@if (validationMessage()) {
<div class="result-empty">{{ validationMessage() }}</div>
}

<section class="resistor-result" aria-live="polite">
  @if (vm.ohms > 0) {
  <div class="result-label">Resistance</div>
  <div class="result-value">
    <span class="result-ohms">{{ vm.ohms | ohms}}</span>
    @if (vm.tolerancePct !== null) {
    <span class="result-meta">± {{ vm.tolerancePct }}%</span>
    }
    @if (vm.tcrPpm !== null) {
    <span class="result-meta">({{ vm.tcrPpm }} ppm/°C)</span>
    }
  </div>
  } @else {
  <div class="result-empty">Select bands to calculate resistance.</div>
  }
</section>

<section class="resistor-help" aria-live="polite">
  <div class="help-actions">
    <button
      class="help-trigger"
      type="button"
      (click)="toggleHelp()"
      [attr.aria-expanded]="showHelp()"
    >
      {{ showHelp() ? 'Hide how it works' : 'Show how it works' }}
    </button>
    <a class="help-link" routerLink="/guide">Open guide</a>
  </div>
  @defer (when showHelp()) {
    @if (showHelp()) {
    <div class="help-card">
      <h2>How it works</h2>
      <p>
        Each color band encodes a digit, a multiplier, and an optional tolerance/TCR value. Changing
        the bands updates the calculated resistance instantly.
      </p>
      <app-reference-panel />
    </div>
    }
  }
</section>
